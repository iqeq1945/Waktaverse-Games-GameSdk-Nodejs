{"version":3,"sources":["../src/common/constants.ts","../src/common/request.ts","../src/common/utils/random.ts","../src/common/utils/sha.ts","../src/lib/oauth.ts","../src/lib/game-link.ts","../src/index.ts"],"names":["DEFAULT_HOST","createClient","createRequestInstance","baseURL","request_default","CHARS","pool","poolOffset","random","bytes","createRandomKey","size","mask","step","id","i","createHash","generateCodeChallenge","codeVerifier","oauth","_request","_host","clientId","redirectUrl","csrfState","codeChallenge","queryParams","query","token","gameLink","Authorization","body","WakGames","options"],"mappings":"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","sourcesContent":["export const DEFAULT_HOST = 'https://waktaverse.games';\r\n","import createClient from 'openapi-fetch';\r\nimport type {paths} from '../types/api'; // generated by openapi-typescript\r\n\r\nexport function createRequestInstance(\r\n  baseURL: string\r\n): ReturnType<typeof createClient<paths>> {\r\n  return createClient<paths>({baseUrl: baseURL});\r\n}\r\n\r\nexport type RequestInstance = ReturnType<typeof createRequestInstance>;\r\n\r\nexport default createRequestInstance;\r\n","// Original source: https://github.com/ai/nanoid/blob/main/index.js\r\n// License: MIT, Modification/Distribution is allowed\r\n\r\nconst CHARS = 'abcdefghijklmnopqrstuvwxyz123456789';\r\n\r\nlet pool: Buffer, poolOffset: number;\r\n\r\nfunction random(bytes: number) {\r\n  if (!pool || pool.length < bytes) {\r\n    pool = Buffer.allocUnsafe(bytes * 128);\r\n    crypto.getRandomValues(pool);\r\n    poolOffset = 0;\r\n  } else if (poolOffset + bytes > pool.length) {\r\n    crypto.getRandomValues(pool);\r\n    poolOffset = 0;\r\n  }\r\n  poolOffset += bytes;\r\n\r\n  return pool.subarray(poolOffset - bytes, poolOffset);\r\n}\r\n\r\nexport function createRandomKey(size = 16) {\r\n  const mask = (2 << (31 - Math.clz32((CHARS.length - 1) | 1))) - 1;\r\n  const step = Math.ceil((1.6 * mask * size) / CHARS.length);\r\n\r\n  let id = '';\r\n\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    const bytes = random(step);\r\n    let i = step;\r\n\r\n    while (i--) {\r\n      id += CHARS[bytes[i]! & mask] || '';\r\n      if (id.length === size) return id;\r\n    }\r\n  }\r\n}\r\n","import {createHash} from 'crypto';\r\n\r\nexport function generateCodeChallenge(codeVerifier: string): string {\r\n  return createHash('sha256')\r\n    .update(Buffer.from(codeVerifier, 'utf8'))\r\n    .digest()\r\n    .toString('base64')\r\n    .replace(/\\+/g, '-')\r\n    .replace(/\\//g, '_')\r\n    .replace(/=+$/, '');\r\n}\r\n","import type {RequestInstance} from '../common/request';\r\n\r\nimport {createRandomKey} from '../common/utils/random';\r\nimport {generateCodeChallenge} from '../common/utils/sha';\r\nimport {IAuthorizeUrl} from '../types/authorize';\r\n\r\nimport type {paths} from '../types/api'; // generated by openapi-typescript\r\n\r\n/**\r\n * OAuth API\r\n * @description 로그인과 관련된 API 기능을 제공합니다.\r\n */\r\nexport const oauth = (\r\n  _request: RequestInstance,\r\n  _host: string,\r\n  clientId: string,\r\n  redirectUrl: string\r\n): {\r\n  getAuthorizeUrl: () => IAuthorizeUrl;\r\n\r\n  token: (\r\n    query: paths['/api/oauth/token']['post']['parameters']['query']\r\n  ) => ReturnType<typeof _request.POST>;\r\n\r\n  refresh: (token: string) => ReturnType<typeof _request.GET>;\r\n} => {\r\n  return {\r\n    /**\r\n     * OAuth 인증\r\n     * @description OAuth 인증을 수행합니다.\r\n     */\r\n    getAuthorizeUrl: () => {\r\n      const csrfState = createRandomKey(16);\r\n      const codeVerifier = createRandomKey(128);\r\n      const codeChallenge = generateCodeChallenge(codeVerifier);\r\n\r\n      const queryParams: paths['/api/oauth/authorize']['get']['parameters']['query'] =\r\n        {\r\n          responseType: 'code',\r\n          clientId,\r\n          callbackUri: redirectUrl,\r\n          state: csrfState,\r\n          challengeMethod: 'S256',\r\n          challenge: codeChallenge,\r\n        };\r\n\r\n      return {\r\n        csrfState,\r\n        codeVerifier,\r\n        codeChallenge,\r\n        url: `${_host}/oauth/authorize?${new URLSearchParams(\r\n          queryParams\r\n        ).toString()}`,\r\n      } as IAuthorizeUrl;\r\n    },\r\n\r\n    /**\r\n     * OAuth 토큰 발급\r\n     * @description OAuth 토큰을 발급합니다.\r\n     */\r\n    token: (\r\n      query: paths['/api/oauth/token']['post']['parameters']['query']\r\n    ) => {\r\n      return _request.POST('/api/oauth/token', {params: {query}});\r\n    },\r\n\r\n    /**\r\n     * OAuth 토큰 갱신\r\n     * @description OAuth Refresh 토큰을 사용하여 OAuth 토큰을 갱신합니다.\r\n     *\r\n     * @param {string} token - JWT Refresh 토큰 값입니다. 이미 Bearer가 Prefix로 붙어있어, 토큰값을 바로 넣으시면 됩니다.\r\n     */\r\n    refresh: (token: string) => {\r\n      return _request.GET('/api/oauth/refresh', {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n    },\r\n  };\r\n};\r\n","import type {RequestInstance} from '../common/request';\r\nimport type {paths} from '../types/api'; // generated by openapi-typescript\r\n\r\n/**\r\n * 게임 연동 API\r\n *\r\n * @description 게임 연동과 관련된 API 기능을 제공합니다.\r\n */\r\nexport const gameLink = (\r\n  _request: RequestInstance\r\n): {\r\n  getProfile: (Authorization: string) => ReturnType<typeof _request.GET>;\r\n  getAchieves: (Authorization: string) => ReturnType<typeof _request.GET>;\r\n\r\n  postAchieve: (\r\n    query: paths['/api/game-link/achieve']['post']['parameters']['query'],\r\n    Authorization: string\r\n  ) => ReturnType<typeof _request.POST>;\r\n\r\n  getStat: (\r\n    query: paths['/api/game-link/stat']['get']['parameters']['query'],\r\n    Authorization: string\r\n  ) => ReturnType<typeof _request.GET>;\r\n\r\n  putStat: (\r\n    body: paths['/api/game-link/stat']['put']['requestBody']['content']['application/json'],\r\n    Authorization: string\r\n  ) => ReturnType<typeof _request.PUT>;\r\n\r\n  getStatBoard: (\r\n    query: paths['/api/game-link/stat-board']['get']['parameters']['query'],\r\n    Authorization: string\r\n  ) => ReturnType<typeof _request.GET>;\r\n} => {\r\n  return {\r\n    /**\r\n     * 사용자 프로필 정보\r\n     * @description 연동된 게임에서 사용자 기본 정보를 얻습니다.\r\n     *\r\n     * @param {string} Authorization - JWT Refresh 토큰 값입니다. 이미 Bearer가 Prefix로 붙어있어, 토큰값을 바로 넣으시면 됩니다.\r\n     */\r\n    getProfile: (Authorization: string) => {\r\n      return _request.GET('/api/game-link/user/profile', {\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n\r\n    /**\r\n     * 도전과제 달성 목록\r\n     * @description 사용자가 달성한 게임 도전과제 목록을 얻습니다.\r\n     */\r\n    getAchieves: (Authorization: string) => {\r\n      return _request.GET('/api/game-link/achieve', {\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n\r\n    /**\r\n     * 도전과제 달성\r\n     * @description 사용자가 게임의 해당 도전과제를 달성했다고 기록합니다.\r\n     */\r\n    postAchieve: (\r\n      query: paths['/api/game-link/achieve']['post']['parameters']['query'],\r\n      Authorization: string\r\n    ) => {\r\n      return _request.POST('/api/game-link/achieve', {\r\n        params: {query},\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n\r\n    /**\r\n     * 통계 목록\r\n     * @description 사용자의 누적 통계 값들을 얻습니다.\r\n     */\r\n    getStat: (\r\n      query: paths['/api/game-link/stat']['get']['parameters']['query'],\r\n      Authorization: string\r\n    ) => {\r\n      return _request.GET('/api/game-link/stat', {\r\n        params: {query},\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n\r\n    /**\r\n     * 통계 입력\r\n     * @description 사용자의 대상 통계 값을 입력합니다.\r\n     */\r\n    putStat: (\r\n      body: paths['/api/game-link/stat']['put']['requestBody']['content']['application/json'],\r\n      Authorization: string\r\n    ) => {\r\n      return _request.PUT('/api/game-link/stat', {\r\n        body,\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n\r\n    /**\r\n     * 전체 사용자 통계\r\n     * @description 대상 통계의 전체 사용자 값을 조회합니다.\r\n     */\r\n    getStatBoard: (\r\n      query: paths['/api/game-link/stat-board']['get']['parameters']['query'],\r\n      Authorization: string\r\n    ) => {\r\n      return _request.GET('/api/game-link/stat-board', {\r\n        params: {query},\r\n        headers: {\r\n          Authorization: `Bearer ${Authorization}`,\r\n        },\r\n      });\r\n    },\r\n  };\r\n};\r\n","import {DEFAULT_HOST} from './common/constants';\r\nimport createRequestInstance, {type RequestInstance} from './common/request';\r\n\r\n// Import all API functions\r\nimport {oauth} from './lib/oauth'; // OAuth 관련 API\r\nimport {gameLink} from './lib/game-link'; // 게임 연동 관련 API\r\n\r\n/**\r\n * Waktaverse Games - Backend SDK Class.\r\n *\r\n * @param {string} host - Host URL.\r\n * @default host = \"https://waktaverse.games\"\r\n *\r\n * @example\r\n * const wakgames = new WakGames({\r\n *  clientId: 'wakttu',\r\n *  redirectUrl: 'https://example.com/callback',\r\n * })\r\n */\r\nexport class WakGames {\r\n  host: string;\r\n  clientId: string;\r\n  redirectUrl: string;\r\n\r\n  public declare oauth: ReturnType<typeof oauth>;\r\n  public declare gameLink: ReturnType<typeof gameLink>;\r\n  private declare _request: RequestInstance;\r\n\r\n  constructor(options: {host?: string; clientId: string; redirectUrl: string}) {\r\n    this.host = options.host || DEFAULT_HOST;\r\n    this.clientId = options.clientId;\r\n    this.redirectUrl = options.redirectUrl;\r\n    this._request = createRequestInstance(this.host);\r\n\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    // init all API functions\r\n    this.oauth = oauth(\r\n      this._request,\r\n      this.host,\r\n      this.clientId,\r\n      this.redirectUrl\r\n    );\r\n\r\n    this.gameLink = gameLink(this._request);\r\n  }\r\n}\r\n"]}